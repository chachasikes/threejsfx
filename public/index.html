<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>StoryTellAR Behaviors Test</title>

<style>
body { margin: 0; }
canvas { width: 100%; height: 100% }
</style>
<script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
<!-- <script src="lib/three.js"></script> -->
<script src="lib/OrbitControls.js"></script>
<script src="lib/hilbert3D.js"></script>
<script src="lib/WebGL.js"></script>
<script src='lib/LineSegmentsGeometry.js'></script>
<script src='lib/LineGeometry.js'></script>
<script src='lib/WireframeGeometry2.js'></script>
<script src='lib/LineMaterial.js'></script>
<script src='lib/LineSegments2.js'></script>
<script src='lib/Line2.js'></script>
<script src='lib/Wireframe.js'></script>
<script src="lib/three-gltf-loader.js"></script>
<script src="lib/ammo.js"></script>
<script src="lib/XRSupport.js"></script>
<script src="lib/three.proton.js"></script>

<style>

h1 { font-family: Verdana, Geneva, sans-serif; font-size: 24px; font-style: normal; font-variant: normal; font-weight: 700; line-height: 26.4px; } h3 { font-family: Verdana, Geneva, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 700; line-height: 15.4px; } p { font-family: Verdana, Geneva, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 20px; } blockquote { font-family: Verdana, Geneva, sans-serif; font-size: 21px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 30px; } pre { font-family: Verdana, Geneva, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: 400; line-height: 18.5714px; }

span {
	width:100px;
	height:100px;
	border:5px solid grey;
	display: block;
	float:left;
	padding:4px;
	margin:4px;
	border-radius:7px;
}
.blox {
	margin: 10px;
}
</style>
</head>
<body>
<!-- <div "commentary">
<h1>BLOX Examples</h1>
See <a href="https://github.com/anselm/blox">github.com/anselm/blox</a>
<h1>Examples</h1>
<a href="#hello_world.js"><span>Hello World</span></a>
<a href="#physics_button.js"><span>Physics Button</span></a>
<a href="#bouncing_scene.js"><span>Bouncing Scene</span></a>
<a href="#proton_particles.js'"><span>Proton Based Particles</span></a>
<a href="#floating_text.js"><span>Floating Text in 3D</span></a>
<a href="#example_tick.js"><span>User scripting</span></a>
<a href="#example_walking.js"><span>Walking</span></a>
<a href="#cherry_blossoms.js"><span>Crude Particle Effects - Cherry Blossoms</span></a>
<a href="#proximity_events.js"><span>Simple Collisions - Fox in Field</span></a>
<a href="#quill_scenes.js"><span>Quill illustration in hand painted skybox</span></a>
</div> -->

<!-- This executes as soon as its imports have fetched -->
<script type=module>
// TODO turns out firefox doesn't support dynamic imports
import {importModule} from './lib/importModule.js'

	(async () => {
    const moduleSpecifier = "./js/Blox.js"
    const module = await importModule(moduleSpecifier)

		// window.onload = (blarg) => {
		// 	let blox = 0
		// 	function gotohash() {
		// 		if(blox) document.body.removeChild(blox.renderer.domElement) // HACK
		// 		let hash = window.location.hash.substr(1)
		// 		if(!hash || !hash.length) return
		// 		let file = "../examples/"+hash
		// 		blox = new Blox(file)
		// 		window.Blox = blox
		// 	}
		// 	window.addEventListener("hashchange", gotohash)
		// 	gotohash()
		// }

		module.Blox.element = "#blox"
		window.Blox = module.Blox
		var event = new Event('loadBlox')
		document.body.dispatchEvent(event)
  })();
</script>
<script>
AFRAME.registerComponent('quill', {
	schema: {
		event: {type: 'string', default: ''},
		message: {type: 'string', default: 'Hello, World!'}
	},
	init: function () {
		var self = this;
		this.eventHandlerFn = function () { console.log(self.data.message); };
	},
	update: function (oldData) {
		var data = this.data;
		var el = this.el;

		// `event` updated. Remove the previous event listener if it exists.
		if (oldData.event && data.event !== oldData.event) {
			el.removeEventListener(oldData.event, this.eventHandlerFn);
		}

		if (data.event) {
			el.addEventListener(data.event, this.eventHandlerFn);
		} else {
			console.log(data.message);
		}
		console.log('Quill initialized')
		try {
			console.log('entity blox', window.Blox, data)
			let Blox = window.Blox;
			let bloxElement = document.querySelector('a-entity[quill]');
			console.log(bloxElement);
			let blox = new Blox('./examples/quill_scenes.js')
			blox.element = 'a-entity[blox]'
		} catch(e) {
			console.log(e)
		}
	}
});

document.body.addEventListener('loadBlox', function (e) {
	// console.log("dispatch loaded", window.Blox)
	var el = document.querySelector('a-entity[blox]');
	el.setAttribute('quill', {event: 'anEvent', message: 'Hello, new event! 3'});
	el.emit('anEvent');
}, false);
</script>

<a-scene>
	 <a-entity blox="event: anEvent; message: Hello, Metaverse!"></a-entity>
</a-scene>

<!-- <div id="blox"></div> -->
</body>
</html>
